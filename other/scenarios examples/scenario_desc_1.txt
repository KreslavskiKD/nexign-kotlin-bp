Сценарий
(Подключение скидки абоненту)

Входные параметры
идентификатор клиента, информация о скидке (id, тип, описание, срок действия (в сек), условия подключения)

Операция 1
Проверить возможность создания скидки (POST запрос к Системе 1)
Формат ответа - список конфликтов, не дающих получить список (поля id, description, type)
Если код ответа 4хх или пришел не пустой список конфликтов - переходим к Операции 6, иначе к Операции 2

Операция 2
Создание скидки (POST запрос к Системе 2)
Формат ответа - созданная скидка (id, срок действия скидки (дата), текущий баланс абонента)
Если код ответа 4хх или 5хх - переходим к Операции 6, иначе к Операции 3

Операция 3
Создание скидки (POST запрос к Системе 3)
Ответ - пустой
Если код ответа 4хх или 5хх - переходим к Операции 6, иначе к Операции 4

Операция 4
Сохранение информации о скидке (POST запрос к Системе 4)
Ответ - пустой
Если код ответа 4хх или 5хх - переходим к Операции 6, иначе к Операции 5

Операция 5
Отправка нотификации о создании скидки (AMQP запрос)
(Успешное завершение сценария, устанавливаем статус сценария Успех)

Операция 6
Отправка нотификации о неудачном создании скидки (AMQP запрос).
Перейти к Операции 7

Операция 7
Откатить скидки в Системе 2 (POST запрос)
Тела ответа нет, код ответа 2хх считать успехом, переходим к Операции 8
Если код ответа другой, завершить сценарий, установить статус сценария Ошибка

Операция 8
Откатить скидки в Системе 3 (POST запрос)
Тела ответа нет, код ответа 2хх считать успехом, завершаем сценарий в статусе Откат
Если код ответа другой, завершить сценарий, установить статус сценария Ошибка

